cd cRIODebug

rem name of object file generated by Eclipse's build system
set ARTIFACT_NAME=Robot2015-Atlas.so

rem for desciptions of these commands, see the FRC cmake library.
powerpc-wrs-vxworks-nm %ARTIFACT_NAME% | tclsh "C:\\Program Files (x86)\\FRC_Toolchain\\mingw\\powerpc-wrs-vxworks\\wind_base\\/host/resource/hutils/tcl/munch.tcl" -c ppc | sed "s/extern void\(.*\);/extern void \1 __attribute__((externally_visible));/" > ctdt.c

powerpc-wrs-vxworks-gcc -c ctdt.c -o ctdt.o -DCPU=PPC603 -DTOOL_FAMILY=gnu -DTOOL=gnu -D_WRS_KERNEL -fmessage-length=0  -mcpu=603 -mstrict-align -mlongcall

powerpc-wrs-vxworks-g++ ctdt.o %ARTIFACT_NAME% -o %ARTIFACT_NAME%.out -DCPU=PPC603 -DTOOL_FAMILY=gnu -DTOOL=gnu -D_WRS_KERNEL -fmessage-length=0  -mcpu=603 -mstrict-align -mlongcall -r -Wl,-X -static -T "%WIND_BASE%\..\share\ldscripts\dkm.ld"

call powerpc-wrs-vxworks-stripsyms %ARTIFACT_NAME%.out "%WIND_BASE%\..\lib\libstdc++.a" "%WIND_BASE%\..\lib\libsupc++.a" "%WIND_BASE%\..\..\lib\gcc\powerpc-wrs-vxworks\4.8.2\libgcc.a"